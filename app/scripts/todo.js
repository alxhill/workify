// Generated by CoffeeScript 1.6.3
angular.module('workify').controller('TodoCtrl', function($scope) {
  chrome.runtime.onMessage.addListener(function(msg, _arg) {
    var tab;
    tab = _arg.tab;
    if (msg === "updateList") {
      return chrome.storage.local.get('todolist', function(value) {
        return $scope.$apply(function() {
          return $scope.load(value);
        });
      });
    }
  });
  $scope.save = function() {
    chrome.storage.local.set({
      todolist: $scope.todos
    });
    return chrome.runtime.sendMessage("updateList");
  };
  $scope.save();
  $scope.load = function(value) {
    var _ref;
    if (value && ((_ref = value.todolist) != null ? _ref.length : void 0) > 0) {
      $scope.todos = value.todolist;
      return $scope.nextid = $scope.todos.length;
    }
  };
  $scope.addTodo = function(title) {
    if (title != null) {
      if (angular.isArray(title)) {
        $scope.todos = $scope.todos.concat(_.map(title, function(el) {
          return {
            title: el,
            done: false,
            id: $scope.nextid++
          };
        }));
      } else {
        $scope.todos.push({
          title: title,
          done: false,
          id: $scope.nextid++
        });
      }
      $scope.todoInput = "";
      return $scope.save();
    }
  };
});
